
fastlane_version "2.26.1"

default_platform :ios

platform :ios do

  desc "Run unit tests and check library"
  lane :test do
    scan(workspace: "Pageboy.xcworkspace", scheme: "Pageboy iOS", clean: true, device: "iPhone 15 (18.0)") 
  end

  desc "Deploy a new version"
  lane :deploy do
    test

    # Compose .xcconfig file path
    configuration = Xcodeproj::Config.new("../Pageboy.xcconfig")
    version = configuration.attributes['PB_VERSION']

    # Push new Github release
    github_release = set_github_release(
      repository_name: "uias/Pageboy",
      api_token: ENV["GITHUB_API_TOKEN"],
      name: version,
      tag_name: version,
      description: "#{version} release.",
      commitish: "main"
    )

    slack(
      message: "Pageboy v#{version} released!" 
    )
  end
end